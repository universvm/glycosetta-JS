<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="glycosetta-stone">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <h2>Hello [[prop1]]!</h2>
  </template>

  <script>
    /**
     * `glycosetta-stone`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class GlycosettaStone extends Polymer.Element {
      static get is() { return 'glycosetta-stone'; }
      static get properties() {
        return {
          prop1: {
              type: String,
              value: 'glycosetta-js',
              observer: '_translate'
          },
          inputValue: {
              reflectToAttribute: true,
              type: String,
              observer: '_translate'
          }
        };
      }
        _translate() {
            var glycanOx = "A2G2S2 (34%)", //TODO: Change the inside with an event listener?
                translated = "",
                translated2 = "",
                //first two are part of the core
                hex = 3,//Hexose
                hexnac = 2, //Hexnac
                deHex = 0, //Deoxyhexose
                neuac = 0; //NeuAC

            // if else to retrieve percentages:
            if (glycanOx.includes("(") === true) { //if it contains a percentage
                var splitCap = glycanOx.split(/(?=[A-Z ])/); //Split should occur by capital letter and space
            } else {
                var splitCap = glycanOx.split(/(?=[A-Z])/); //else no percentage available so splitting only occurs by Capitals
            }

            for (var i = 0; i < splitCap.length; i++) {
                if (splitCap[i].includes("A") === true) {
                    hexnac += parseInt(splitCap[i].replace("A", "")) //Translating into integer and adding
                    // add conditions for "-"
                } else if (splitCap[i].includes("B") === true) {
                    hexnac += parseInt(splitCap[i].replace("B", "")) //Translating into integer and adding

                } else if (splitCap[i].includes("F") === true) {
                    deHex += parseInt(splitCap[i].replace("F", "")) //Translating into integer and adding

                } else if (splitCap[i].includes("G") === true) {
                    hex += parseInt(splitCap[i].replace("G", "")) //Translating into integer and adding

                } else if (splitCap[i].includes("S") === true) {
                    neuac += parseInt(splitCap[i].replace("S", "")) //Translating into integer and adding

                } else if (splitCap[i].includes("H") === true) {
                    if (glycanOx === "Hy") {
                        translated = "53000000000000";
                    }
                } else if (splitCap[i].includes("C") === true) {
                    if (glycanOx === "Core F") {
                        translated = "32100000000000";
                    }
                } else if (splitCap[i].includes("M") === true) {
                    if (glycanOx.includes("Man") === true) { //TODO: This does NOT take into account ManX-Y (ranges)
                        if (glycanOx.includes("-") === true) { //if it is a range
                            var range = glycanOx.replace("Man", "");
                            var range = range.split("-");
                            // TODO: what do we do with ranges?
                        } else { //No range = party
                            hex += parseInt(glycanOx.replace("Man", "")) - 3; //removing 3 as they already in the core
                        }
                    } else { //else it's just M
                        if (glycanOx.includes("-") === true) { //if it is a range
                            var range = glycanOx.replace("M", "");
                            var range = range.split("-");
                            // TODO: what do we do with ranges?
                        } else { //No range = party
                            hex += parseInt(glycanOx.replace("M", "")) - 3; //removing 3 as they already in the core
                        }
                    }
                }


                //else {
                //    splitCap[i] = splitCap[i].replace("S", "");
                //}
            }
            // merging into translated
            //TODO: Above 9 shall we fix it here?
            translated = '' + hex + hexnac + deHex + neuac + "0000000000";
            console.log(translated);
            console.log(hex,hexnac);
            console.log(splitCap)
        }
    }
    window.customElements.define(GlycosettaStone.is, GlycosettaStone);
  </script>
</dom-module>
